## 基于UDEV设备规则

#### 1、lsusb查看设备号

```shell
	Bus 002 Device 003: ID 1235:0002 Focusrite-Novation Speedio
```



#### 2、使用 aplay -l查看卡号和名称，输出：

```shell
card 1: Y11 [Y11], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
```

##### 发现设备名称Y11，和Focusrite-Novation不一致，使用Y11作为识别名



#### 3、使用amixer 查看通道

```shell
root@aidlux:/home/aidlux/aidcode/test#amixer -c 1
Simple mixer control 'PCM',0
  Capabilities: pvolume pswitch pswitch-joined
  Playback channels: Front Left - Front Right
  Limits: Playback 0 - 4096
  Mono:
  Front Left: Playback 819 [20%] [3.19dB] [on]
  Front Right: Playback 819 [20%] [3.19dB] [on]
Simple mixer control 'Mic',0
  Capabilities: cvolume cswitch cswitch-joined
  Capture channels: Front Left - Front Right
  Limits: Capture 0 - 4096
  Front Left: Capture 4096 [100%] [16.00dB] [on]
  Front Right: Capture 4096 [100%] [16.00dB] [on]
```

##### 	设备唯一暴露的音量play控制项（声音输出通道）为PCM



#### 4、创建文件/usr/local/bin/set-usb-audio-volume.sh

#### <span style="color:red">并使用chmod +x增加执行权限，否则规则文件命令没有执行权</span>

```shell
#!/bin/bash

# 获取 Y11 声卡的卡号
card_num=$(grep -m1 'Y11' /proc/asound/cards | awk '{print $1}')

# 验证卡号存在
if [ -n "$card_num" ]; then
        echo "检测到 Y11 声卡，编号为 $card_num"
        # 设置控制项
	 	amixer -c "$card_num" sset 'PCM' 20% 2>/dev/null || \
        echo "找不到匹配的控制项，需手动设置"
else
        echo "未检测到 Y11 声卡"
fi
```

#### 5、创建 udev 规则

创建一个规则文件，比如：

```shell
vim /etc/udev/rules.d/99-usb-audio-volume.rules
```

添加如下内容（替换 `1235` 和 `0002` 为你的设备 ID）：

```shell
ACTION=="add", SUBSYSTEM=="sound", ATTRS{idVendor}=="1235", ATTRS{idProduct}=="0002", RUN+="/usr/local/bin/set-usb-audio-volume.sh"
```

> #### 说明：
>
> - `ACTION=="add"` 表示设备插入时触发
> - `SUBSYSTEM=="sound"` 针对音频设备
> - `RUN+=...` 是触发脚本



#### 6、重新加载 udev 规则

```shell
udevadm control --reload-rules
```

然后重新插入你的 USB 设备，音量应该会自动设置为你脚本中设定的值。